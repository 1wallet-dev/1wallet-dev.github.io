<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<title data-rh="true">Token-Tracking | One Wallet Docs</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://one-wallet-dev.github.io/docs/Token-Tracking"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Token-Tracking | One Wallet Docs"><meta data-rh="true" name="description" content="ONE Wallet tracks the wallet&#x27;s ownership of tokens (EIP-20, 721, 1155) on the smart contract itself. This was first implemented in #52 then subsequently moved to an independent file as the main smart contract becomes too large."><meta data-rh="true" property="og:description" content="ONE Wallet tracks the wallet&#x27;s ownership of tokens (EIP-20, 721, 1155) on the smart contract itself. This was first implemented in #52 then subsequently moved to an independent file as the main smart contract becomes too large."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://one-wallet-dev.github.io/docs/Token-Tracking"><link data-rh="true" rel="alternate" href="https://one-wallet-dev.github.io/docs/Token-Tracking" hreflang="en"><link data-rh="true" rel="alternate" href="https://one-wallet-dev.github.io/docs/Token-Tracking" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.103c330a.css">
<link rel="preload" href="/assets/js/runtime~main.2d210387.js" as="script">
<link rel="preload" href="/assets/js/main.9a5f82bc.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/1wallet.png" alt="One WalletLogo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/1wallet.png" alt="One WalletLogo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">One Wallet</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/home">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/one-wallet-dev/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/home">home</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/App-Integration">1wallet App Integration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Call-for-Developers">Call-for-Developers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Client Security">Client Security</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Security-Goals">Security Goals</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Smart-Contract-References">Smart-Contract-References</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/Token-Tracking">Token-Tracking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Tutorials">Tutorials</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Web-Client:-Data-Stored-Locally">Web-Client:-Data-Stored-Locally</a></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/">üè†</a></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docs/Token-Tracking">Token-Tracking</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Token-Tracking</h1></header><p>ONE Wallet tracks the wallet&#x27;s ownership of tokens (EIP-20, 721, 1155) on the smart contract itself. This was first implemented in <a href="https://github.com/polymorpher/one-wallet/pull/52/files" target="_blank" rel="noopener noreferrer">#52</a> then subsequently moved to <a href="https://github.com/polymorpher/one-wallet/blob/7b8a94f22c171a20f3c980556b8a2e565fcebcf0/code/contracts/TokenTracker.sol" target="_blank" rel="noopener noreferrer">an independent file</a> as the main smart contract becomes too large.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="background">Background<a class="hash-link" href="#background" title="Direct link to heading">‚Äã</a></h3><p>The approach taken by ONE Wallet is uncommon. Most wallets rely on tracking solutions off-chain. For example, MetaMask asks users to manually add the contract address of each token, only then the wallet would check the balance of the token, recognize the user&#x27;s ownership, and allow operations on the tokens, if the user holds any balance for that token. Some other wallets rely on APIs provided by some centralized index servers. For example, Etherscan provides public APIs for tracking ERC-20 and NFT (both ERC-721 and 1155) tokens. OpenSea provides more comprehensive APIs for tracking NFTs, including the information about the token contract itself, the distribution of token owners for any token, and each user&#x27;s list of owned token assets. Wallets such as Coinbase Wallet and TrustWallet rely on such APIs to automatically lookup and update user&#x27;s token ownerships and balances. However, such APIs have limitations and often has undocumented, non-standard customizations. For example, OpenSea&#x27;s API retrieve token contract&#x27;s information only once. It ignores subsequent updates on metadata and/or name and symbols. The API server also caches image and video data that are provided in token metadata, and stores downsampled versions on centralized storage services (Google Storage). Only the cached versions are served via the API, the original, raw metadata became hidden from API user. Moreover, the APIs uses non-standard contract interface to retrieve name, symbol, and contract metadata on ERC-721 and ERC-1155 contracts.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="analysis">Analysis<a class="hash-link" href="#analysis" title="Direct link to heading">‚Äã</a></h3><p>Nonetheless, reliance on these APIs are not unreasonable. On Ethereum, the gas cost is high. Many solutions already exist for tracking tokens off-chain, though they maintained by relatively few centralized operators. In our view, wallets on Ethereum rely on those centralized API servers for two primary reasons:</p><ul><li>Most wallets are not smart contract wallets. They are client-side based so they have to use those APIs. </li><li>Smart contract wallets need to stay competitive. The gas cost of smart contract wallet was already a key issue on Ethereum. Incurring extra cost on receiving / sending tokens for the sole purpose of tracking tokens would seem unnecessary, and may lead to a loss on the user base if competitors&#x27;s wallets are cheaper to operate. </li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="one-wallets-approach">ONE Wallet&#x27;s Approach<a class="hash-link" href="#one-wallets-approach" title="Direct link to heading">‚Äã</a></h3><p>Here, ONE Wallet faces a very different set of settings. Since ONE Wallet is running on Harmony network exclusively at this time, it does not have similar constraints on gas cost. The gas cost for tracking tokens is nearly negligible and will very likely stay so, given the high efficiency of the blockchain. On the other hand, Harmony network does not have established central operators offering APIs for tracking tokens. Existing solutions, such as <a href="https://explorer.harmony.one/" target="_blank" rel="noopener noreferrer">Harmony Block Explorer</a>, does poorly on tracking arbitrary tokens and does not seem to be tracking EIP-721 and 1155 tokens correctly (<a href="https://explorer.harmony.one/address/0x6c01e9fd32da6afc9673d8aeb795be320e0d2961" target="_blank" rel="noopener noreferrer">example</a>). </p><p>Even if there were reliable APIs offered by central operators, tracking tokens on-chain would still provide far superior user experience. Based on our implementation (see above), tracking immediate occur when the user receive a EIP-721 or 1155 token, or when the user sends a EIP-20 token. The user is not required to wait or take any action for this to occur. The tracking implementation only uses very few bytes per token. For each token, it stores the token id (32 bytes), token contract address (20 bytes), and token type (1 byte), and computes a 32-byte key based on these three components. </p><p>The benefits are clear: </p><ul><li>when the user restore their wallets at a different client (or device), the client automatically restore the list of tokens being tracked by obtaining a copy from the smart contract. In comparison, users of other wallets would have to add each token back one-by-one. </li><li>Most importantly, when recovery is triggered, ONE Wallet can send all tokens owned by the user to the recovery address, not just ONEs.</li></ul><p>It is also important to note that the tracking does not need to be robust or 100% correct. The tracking mechanism only tracks which tokens are of interest to the wallet user. It does not track the balance. The tracking is guaranteed not to miss a token (except EIP-20 tokens which the wallet only received but never sends out). They client should retrieve the balance of each token by querying the blockchain. The client can also add or subtract any token from the tracking list as the client sees fit. The smart contract also provides interfaces for the user to add, subtract, override the tracking list if they wish to.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Token-Tracking.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/Smart-Contract-References"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Smart-Contract-References</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/Tutorials"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Tutorials</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#background" class="table-of-contents__link toc-highlight">Background</a></li><li><a href="#analysis" class="table-of-contents__link toc-highlight">Analysis</a></li><li><a href="#one-wallets-approach" class="table-of-contents__link toc-highlight">ONE Wallet&#39;s Approach</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/home">Home</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/one-wallet-dev/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 One Wallet. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.2d210387.js"></script>
<script src="/assets/js/main.9a5f82bc.js"></script>
</body>
</html>