<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<title data-rh="true">Web-Client:-Data-Stored-Locally | One Wallet Docs</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://one-wallet-dev.github.io/docs/Web-Client:-Data-Stored-Locally"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Web-Client:-Data-Stored-Locally | One Wallet Docs"><meta data-rh="true" name="description" content="Partial proofs"><meta data-rh="true" property="og:description" content="Partial proofs"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://one-wallet-dev.github.io/docs/Web-Client:-Data-Stored-Locally"><link data-rh="true" rel="alternate" href="https://one-wallet-dev.github.io/docs/Web-Client:-Data-Stored-Locally" hreflang="en"><link data-rh="true" rel="alternate" href="https://one-wallet-dev.github.io/docs/Web-Client:-Data-Stored-Locally" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.103c330a.css">
<link rel="preload" href="/assets/js/runtime~main.2d210387.js" as="script">
<link rel="preload" href="/assets/js/main.9a5f82bc.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/1wallet.png" alt="One WalletLogo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/1wallet.png" alt="One WalletLogo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">One Wallet</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/home">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/one-wallet-dev/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/home">home</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/App-Integration">1wallet App Integration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Call-for-Developers">Call-for-Developers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Client Security">Client Security</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Security-Goals">Security Goals</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Smart-Contract-References">Smart-Contract-References</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Token-Tracking">Token-Tracking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Tutorials">Tutorials</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/Web-Client:-Data-Stored-Locally">Web-Client:-Data-Stored-Locally</a></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/">üè†</a></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docs/Web-Client:-Data-Stored-Locally">Web-Client:-Data-Stored-Locally</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Web-Client:-Data-Stored-Locally</h1></header><h2 class="anchor anchorWithStickyNavbar_mojV" id="partial-proofs">Partial proofs<a class="hash-link" href="#partial-proofs" title="Direct link to heading">‚Äã</a></h2><p>1wallet web client stores partial proofs for completing transactions in the browser&#x27;s <a href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API/Using_IndexedDB" target="_blank" rel="noopener noreferrer">IndexedDB</a>. The proofs are considered &quot;partial&quot; because they can only be completed and used for authorizing transactions, if and only if the user provides the correct authenticator code(s) (6-digit or 12-digit OTPs). The proofs are made robust against brute-force using techniques described in <a href="https://github.com/polymorpher/one-wallet/wiki/Client-Security" target="_blank" rel="noopener noreferrer">Client Security</a>. The proofs are the OTP Merkle Tree described in the <a href="https://github.com/polymorpher/one-wallet/wiki#otp-merkle-tree" target="_blank" rel="noopener noreferrer">Wiki</a><sup>[1]</sup></p><p>[1]<!-- -->: not exactly - we will update the Wiki later to describe the improvements and revisions we made during the implementation).</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="access-to-partial-proofs">Access to partial proofs<a class="hash-link" href="#access-to-partial-proofs" title="Direct link to heading">‚Äã</a></h3><p>These partial proofs are managed via a <a href="https://github.com/polymorpher/one-wallet/blob/1ccc4efb5a94476a5adb4594bcbed9300ce0237a/code/client/src/storage/index.js" target="_blank" rel="noopener noreferrer">storage interface</a> using <a href="https://github.com/localForage/localForage" target="_blank" rel="noopener noreferrer">localforage</a>. Each wallet stores a key-value pair to the storage. The key corresponds to the root parameter of a wallet, which uniquely identifies the wallet and maps to a Google Authenticator entry. The values are the partial proofs, represented by an array of byte arrays (Uint8Array[]). Each array represents a layer in the OTP Merkle Tree, starting from the leaves at index 0 and followed by one layer above the leaves at index 1, and so on. Each proof is 32-byte long. For a wallet with lifespan of a year, about 64MB of proofs are stored, with the leaves occupying about 32MB.</p><p>When the wallet is upgraded, the address of the wallet &quot;changes&quot; (a new wallet is generated and the old wallet starts to forward everything to the new wallet), but its root parameter remains unchanged. As a result, the user could still use the same Google Authenticator entry to authorize transactions for the wallet, and we do not need to update anything in the storage for the partial proofs of the wallet. For</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="example-of-using-partial-proofs">Example of using partial proofs<a class="hash-link" href="#example-of-using-partial-proofs" title="Direct link to heading">‚Äã</a></h3><p>Every transaction in 1wallet requires completing a commit-reveal process. The partial proofs are loaded at the beginning of this process. See <a href="https://github.com/polymorpher/one-wallet/blob/1ccc4efb5a94476a5adb4594bcbed9300ce0237a/code/lib/api/flow.js#L71" target="_blank" rel="noopener noreferrer">/code/lib/api/flow.js:L71</a>. Note that even though the entire 64MB proofs are loaded, only a 32-byte chunk of the 32MB worth of leaves is used, followed by its ancestors (about 20). The position of the leaf used is based on the current time and/or operation type. This means we can store and access the proofs more efficiently and securely in the future. Right now, read and write to the proofs have negligible performance impact (&lt;0.2 seconds on a 2014 iMac computer, based on <code>/benchmark</code>).</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="states">States<a class="hash-link" href="#states" title="Direct link to heading">‚Äã</a></h2><p>In addition to the partial proofs, 1wallet also stores the state of each wallet via Redux. See <a href="https://github.com/polymorpher/one-wallet/blob/1ccc4efb5a94476a5adb4594bcbed9300ce0237a/code/client/src/state/store.js" target="_blank" rel="noopener noreferrer">/code/client/src/store.js</a>. The Redux store is also backed by localforage using IndexedDB, albeit under a separate index. See <a href="https://github.com/polymorpher/one-wallet/blob/1ccc4efb5a94476a5adb4594bcbed9300ce0237a/code/client/src/state/rootReducer.js" target="_blank" rel="noopener noreferrer">code/client/src/state/rootReducer.js</a>. The layout of the state and the default values are shown in the reducer for wallets. See <a href="https://github.com/polymorpher/one-wallet/blob/1ccc4efb5a94476a5adb4594bcbed9300ce0237a/code/client/src/state/modules/wallet/reducers.js" target="_blank" rel="noopener noreferrer">/code/client/src/state/modules/wallet/reducers.js</a>. Note that the specific details for each key-value in the <code>state.wallet</code> object is not given in the default value, though the actions provide some guidance on what is generally expected. Please search and consult with usages of <code>useSelector(state =&gt; state.wallet...)</code> in the project for more information, as well as <code>dispatch(walletActions.updateWallet(...))</code>. </p><p>For example, the wallet creation component provides rich information about the meaning of each field in each wallet. See <a href="https://github.com/polymorpher/one-wallet/blob/1ccc4efb5a94476a5adb4594bcbed9300ce0237a/code/client/src/pages/Create.jsx#L219" target="_blank" rel="noopener noreferrer">/code/client/src/pages/Create.jsx#L219</a>.</p><p>The address input component provides rich information about the <code>knownAddresses</code> object. See <a href="https://github.com/polymorpher/one-wallet/blob/1ccc4efb5a94476a5adb4594bcbed9300ce0237a/code/client/src/components/AddressInput.jsx#L162" target="_blank" rel="noopener noreferrer">/code/client/src/components/AddressInput.jsx#L162</a></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="restoration">Restoration<a class="hash-link" href="#restoration" title="Direct link to heading">‚Äã</a></h2><p>All partial proofs and states can be regenerated using the Google Authenticator seed (represented as a QR code) and public information on the blockchain. Try it at <a href="https://1wallet.crazy.one/restore" target="_blank" rel="noopener noreferrer">https://1wallet.crazy.one/restore</a>, and see <a href="https://github.com/polymorpher/one-wallet/blob/1ccc4efb5a94476a5adb4594bcbed9300ce0237a/code/client/src/pages/Restore.jsx" target="_blank" rel="noopener noreferrer">/code/client/src/pages/Restore.jsx</a> for more information.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Web-Client:-Data-Stored-Locally.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/Tutorials"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Tutorials</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#partial-proofs" class="table-of-contents__link toc-highlight">Partial proofs</a><ul><li><a href="#access-to-partial-proofs" class="table-of-contents__link toc-highlight">Access to partial proofs</a></li><li><a href="#example-of-using-partial-proofs" class="table-of-contents__link toc-highlight">Example of using partial proofs</a></li></ul></li><li><a href="#states" class="table-of-contents__link toc-highlight">States</a></li><li><a href="#restoration" class="table-of-contents__link toc-highlight">Restoration</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/home">Home</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/one-wallet-dev/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 One Wallet. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.2d210387.js"></script>
<script src="/assets/js/main.9a5f82bc.js"></script>
</body>
</html>